import http.client
import urllib.parse
import sys

from libstrava import edgestest, gradtest, pointstest

HOST = '127.0.0.1'
PORT = 8080

def request(content):
    conn = http.client.HTTPConnection(HOST, PORT)

    headers = { 'content-type': 'application/x-www-form-urlencoded', }
    body = 'full_data=' + urllib.parse.quote(content)
    conn.request('POST', '/api/v2', body=body, headers=headers)

    r = conn.getresponse()
    return r.read().decode()

def main():
    content = """35
0.2633333333333333 0.6133333333333333
0.265 0.6066666666666667
0.26666666666666666 0.5933333333333334
0.27 0.5733333333333334
0.2783333333333333 0.5166666666666667
0.295 0.4533333333333333
0.295 0.45
0.315 0.4266666666666667
0.3383333333333333 0.41333333333333333
0.36833333333333335 0.46
0.37333333333333335 0.4866666666666667
0.375 0.5033333333333333
0.375 0.5166666666666667
0.365 0.6
0.3616666666666667 0.6133333333333333
0.35833333333333334 0.63
0.355 0.6533333333333333
0.34833333333333333 0.7066666666666667
0.345 0.7266666666666667
0.345 0.7366666666666667
0.3233333333333333 0.7933333333333333
0.31833333333333336 0.8066666666666666
0.315 0.8066666666666666
0.305 0.8133333333333334
0.3016666666666667 0.82
0.295 0.82
0.29333333333333333 0.82
0.2833333333333333 0.8133333333333334
0.265 0.8066666666666666
0.255 0.8
0.25 0.7933333333333333
0.23833333333333334 0.77
0.23333333333333334 0.76
0.20666666666666667 0.6866666666666666
0.205 0.6566666666666666
28
0.41833333333333333 0.68
0.39166666666666666 0.6533333333333333
0.3416666666666667 0.5733333333333334
0.2916666666666667 0.52
0.24666666666666667 0.4266666666666667
0.23833333333333334 0.4166666666666667
0.22833333333333333 0.4066666666666667
0.22333333333333333 0.4066666666666667
0.21833333333333332 0.4033333333333333
0.21833333333333332 0.4033333333333333
0.215 0.4066666666666667
0.21166666666666667 0.42
0.20833333333333334 0.5166666666666667
0.20833333333333334 0.5466666666666666
0.21166666666666667 0.5933333333333334
0.215 0.6133333333333333
0.215 0.62
0.22166666666666668 0.6433333333333333
0.22666666666666666 0.7066666666666667
0.22833333333333333 0.7266666666666667
0.22666666666666666 0.7333333333333333
0.22666666666666666 0.7366666666666667
0.21833333333333332 0.76
0.21666666666666667 0.7666666666666667
0.215 0.7666666666666667
0.215 0.7733333333333333
0.21333333333333335 0.7733333333333333
0.21333333333333335 0.78"""
    print(request(content))
    for file in sys.argv[1:]:
        if file == "edges" or file == "edges.py":
            edgestest()
        elif file == "fast_gradient_decent" or file == "fast_gradient_decent.py" or file == "gradient_decent" or file == "gradient_decent.py":
            gradtest()
        elif file == "points" or file == "points.py":
            pointstest()
        else:
            print(f"not found: {file}")

if __name__ == "__main__":
    main()
