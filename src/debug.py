import http.client
import urllib.parse
import sys

from libstrava import edgestest, gradtest, pointstest

HOST = '127.0.0.1'
PORT = 8080

def request(content):
    conn = http.client.HTTPConnection(HOST, PORT)

    headers = { 'content-type': 'application/x-www-form-urlencoded', }
    body = 'full_data=' + urllib.parse.quote(content)
    conn.request('POST', '/api/v2', body=body, headers=headers)

    r = conn.getresponse()
    return r.read().decode()

def main():
    content_good = """32
0.245 0.44333333333333336
0.255 0.43333333333333335
0.26166666666666666 0.43
0.2683333333333333 0.42333333333333334
0.29833333333333334 0.38
0.3016666666666667 0.33
0.3 0.32666666666666666
0.295 0.31666666666666665
0.2916666666666667 0.31333333333333335
0.28833333333333333 0.30666666666666664
0.285 0.30333333333333334
0.27166666666666667 0.29333333333333333
0.26166666666666666 0.29
0.25166666666666665 0.2866666666666667
0.23166666666666666 0.29
0.22833333333333333 0.29333333333333333
0.22166666666666668 0.3
0.22 0.30333333333333334
0.21833333333333332 0.30666666666666664
0.20833333333333334 0.32
0.205 0.33
0.19833333333333333 0.3466666666666667
0.18333333333333332 0.4166666666666667
0.19 0.42
0.20333333333333334 0.4266666666666667
0.21333333333333335 0.43333333333333335
0.215 0.43666666666666665
0.215 0.44
0.22833333333333333 0.44
0.23 0.44
0.235 0.44333333333333336
0.235 0.44333333333333336
0
37
0.24 0.44333333333333336
0.27166666666666667 0.4533333333333333
0.2916666666666667 0.4633333333333333
0.2966666666666667 0.4666666666666667
0.305 0.47333333333333333
0.31 0.4766666666666667
0.3233333333333333 0.5366666666666666
0.31 0.5666666666666667
0.29 0.5866666666666667
0.27166666666666667 0.5933333333333334
0.25 0.5933333333333334
0.24166666666666667 0.5866666666666667
0.23 0.5733333333333334
0.22166666666666668 0.5666666666666667
0.21666666666666667 0.56
0.21333333333333335 0.5533333333333333
0.205 0.5233333333333333
0.20333333333333334 0.5033333333333333
0.20333333333333334 0.49
0.20333333333333334 0.48
0.205 0.47
0.20833333333333334 0.4666666666666667
0.21166666666666667 0.4666666666666667
0.215 0.46
0.21666666666666667 0.46
0.21833333333333332 0.46
0.22333333333333333 0.46
0.225 0.46
0.22666666666666666 0.46
0.23 0.45666666666666667
0.23166666666666666 0.4533333333333333
0.23166666666666666 0.4533333333333333
0.23166666666666666 0.45
0.23333333333333334 0.44666666666666666
0.23333333333333334 0.44666666666666666
0.23333333333333334 0.44
0.23333333333333334 0.44
49
0.32666666666666666 0.5066666666666667
0.3466666666666667 0.5
0.355 0.5
0.35833333333333334 0.5
0.36333333333333334 0.5
0.3933333333333333 0.5033333333333333
0.39666666666666667 0.5033333333333333
0.40166666666666667 0.5033333333333333
0.405 0.5033333333333333
0.44166666666666665 0.5
0.4483333333333333 0.49666666666666665
0.465 0.4866666666666667
0.47833333333333333 0.47
0.5016666666666667 0.45
0.5116666666666667 0.44
0.5166666666666667 0.43666666666666665
0.5283333333333333 0.43
0.5283333333333333 0.4266666666666667
0.5283333333333333 0.42
0.5233333333333333 0.4
0.5216666666666666 0.39666666666666667
0.505 0.36
0.5016666666666667 0.35333333333333333
0.485 0.3333333333333333
0.475 0.32
0.47 0.31666666666666665
0.465 0.30666666666666664
0.46 0.3
0.4583333333333333 0.3
0.435 0.27666666666666667
0.425 0.27
0.4216666666666667 0.27
0.4116666666666667 0.27
0.4083333333333333 0.27
0.405 0.27
0.4 0.27
0.3933333333333333 0.27666666666666667
0.37666666666666665 0.28
0.37333333333333335 0.28
0.37166666666666665 0.2833333333333333
0.36666666666666664 0.2866666666666667
0.36333333333333334 0.2866666666666667
0.36 0.2866666666666667
0.33 0.31333333333333335
0.32666666666666666 0.31666666666666665
0.31666666666666665 0.33
0.31333333333333335 0.3333333333333333
0.31 0.33666666666666667
0.30833333333333335 0.34"""
    content = """43
0.295 0.33666666666666667
0.29 0.35333333333333333
0.2816666666666667 0.38
0.275 0.41
0.2683333333333333 0.44
0.26 0.46
0.25166666666666665 0.4866666666666667
0.245 0.5333333333333333
0.245 0.5733333333333334
0.245 0.58
0.24833333333333332 0.6
0.25833333333333336 0.62
0.2633333333333333 0.63
0.2683333333333333 0.6333333333333333
0.2833333333333333 0.65
0.295 0.6566666666666666
0.3016666666666667 0.6566666666666666
0.31166666666666665 0.6566666666666666
0.3233333333333333 0.6533333333333333
0.33 0.6466666666666666
0.335 0.64
0.35333333333333333 0.62
0.37 0.5966666666666667
0.385 0.58
0.4066666666666667 0.4866666666666667
0.4116666666666667 0.47333333333333333
0.4166666666666667 0.4533333333333333
0.41833333333333333 0.4533333333333333
0.41833333333333333 0.44666666666666666
0.415 0.38333333333333336
0.3933333333333333 0.3233333333333333
0.3516666666666667 0.2733333333333333
0.3466666666666667 0.27
0.3383333333333333 0.26666666666666666
0.3233333333333333 0.26666666666666666
0.31833333333333336 0.26666666666666666
0.30833333333333335 0.27
0.30833333333333335 0.2733333333333333
0.305 0.2733333333333333
0.305 0.2733333333333333
0.3016666666666667 0.27666666666666667
0.3016666666666667 0.2833333333333333
0.29833333333333334 0.30666666666666664
45
0.28833333333333333 0.66
0.2866666666666667 0.6666666666666666
0.285 0.6766666666666666
0.27 0.7266666666666667
0.26166666666666666 0.7533333333333333
0.25833333333333336 0.78
0.25833333333333336 0.7833333333333333
0.27666666666666667 0.84
0.2916666666666667 0.8533333333333334
0.315 0.8733333333333333
0.325 0.88
0.395 0.9066666666666666
0.405 0.9133333333333333
0.445 0.9066666666666666
0.45166666666666666 0.9
0.455 0.8933333333333333
0.4583333333333333 0.8866666666666667
0.46166666666666667 0.8766666666666667
0.465 0.8633333333333333
0.4666666666666667 0.8566666666666667
0.4666666666666667 0.8466666666666667
0.4683333333333333 0.82
0.455 0.72
0.43166666666666664 0.6666666666666666
0.42333333333333334 0.6566666666666666
0.41833333333333333 0.65
0.405 0.63
0.395 0.6233333333333333
0.38166666666666665 0.62
0.375 0.62
0.37166666666666665 0.6133333333333333
0.36666666666666664 0.6133333333333333
0.365 0.6133333333333333
0.3616666666666667 0.6133333333333333
0.36 0.6133333333333333
0.3566666666666667 0.6133333333333333
0.355 0.6133333333333333
0.3416666666666667 0.6233333333333333
0.33666666666666667 0.6266666666666667
0.33166666666666667 0.63
0.3283333333333333 0.6333333333333333
0.3233333333333333 0.64
0.32166666666666666 0.64
0.31166666666666665 0.65
0.31 0.6533333333333333
62
0.465 0.73
0.47 0.7266666666666667
0.48 0.72
0.49166666666666664 0.72
0.505 0.72
0.515 0.72
0.545 0.72
0.5583333333333333 0.72
0.5683333333333334 0.72
0.5816666666666667 0.7133333333333334
0.5966666666666667 0.71
0.625 0.7
0.635 0.6933333333333334
0.6583333333333333 0.6866666666666666
0.69 0.6633333333333333
0.7033333333333334 0.6566666666666666
0.7116666666666667 0.6533333333333333
0.7266666666666667 0.6466666666666666
0.7283333333333334 0.6466666666666666
0.7316666666666667 0.6433333333333333
0.7333333333333333 0.64
0.735 0.6333333333333333
0.735 0.6333333333333333
0.735 0.63
0.735 0.6233333333333333
0.7316666666666667 0.6133333333333333
0.725 0.5733333333333334
0.7216666666666667 0.5666666666666667
0.7216666666666667 0.55
0.72 0.5466666666666666
0.7166666666666667 0.5266666666666666
0.715 0.5133333333333333
0.7083333333333334 0.48
0.7 0.4533333333333333
0.695 0.44333333333333336
0.6783333333333333 0.4066666666666667
0.65 0.38
0.6416666666666667 0.37333333333333335
0.6216666666666667 0.37333333333333335
0.6016666666666667 0.37333333333333335
0.57 0.38333333333333336
0.565 0.38333333333333336
0.5516666666666666 0.39
0.5216666666666666 0.4033333333333333
0.5116666666666667 0.4066666666666667
0.49666666666666665 0.41
0.49333333333333335 0.41
0.47 0.4166666666666667
0.465 0.42
0.4583333333333333 0.42
0.455 0.42333333333333334
0.45166666666666666 0.4266666666666667
0.4483333333333333 0.4266666666666667
0.445 0.4266666666666667
0.44 0.43
0.43833333333333335 0.43
0.43666666666666665 0.43
0.435 0.43
0.425 0.43333333333333335
0.4216666666666667 0.43333333333333335
0.4216666666666667 0.43333333333333335
0.42 0.43333333333333335"""
    print(request(content))
    for file in sys.argv[1:]:
        if file == "edges" or file == "edges.py":
            edgestest()
        elif file == "fast_gradient_decent" or file == "fast_gradient_decent.py" or file == "gradient_decent" or file == "gradient_decent.py":
            gradtest()
        elif file == "points" or file == "points.py":
            pointstest()
        else:
            print(f"not found: {file}")

if __name__ == "__main__":
    main()
